:root {
  --c-primary: #5d4037;
  --c-secondary: #8d6e63;
  --c-gold: #d4af37;
  --c-bg: #f4f1ea;
  --c-dark: #2c1b18;
  --s: 90px; 
  --r: 24px; 
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Lato', sans-serif;
  background: linear-gradient(135deg, #1e1e1e 0%, #3e2723 100%);
  color: var(--c-dark);
  min-height: 100vh;
  overflow-x: hidden;
  padding-bottom: 40px;
}

.main-wrapper { 
  width: 100%; 
  min-height: 100vh; 
  padding-top: 20px; 
  display: flex; 
  justify-content: center; 
  align-items: center; 
}

.game-screen { 
  display: none; 
  width: 100%; 
}
.game-screen.active { 
  display: block; 
  animation: fadeIn 0.5s ease; 
}
@keyframes fadeIn { from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)} }

.content-card {
  max-width: 550px; 
  margin: 0 auto;
  border: 4px solid var(--c-primary); 
  background: var(--c-bg);
  box-shadow: 0 20px 40px rgba(0,0,0,0.5); 
  border-radius: 15px;
}
.rules-box {
  background: rgba(141, 110, 99, 0.1); 
  border-radius: 10px;
  border-left: 4px solid var(--c-primary);
}

.btn-wood {
  background-color: var(--c-primary); 
  color: var(--c-gold);
  border: 2px solid var(--c-gold); 
  font-family: 'Cinzel', serif; 
  font-weight: bold;
}
.btn-wood:hover { 
  background-color: #3e2723; 
  color: #fff; 
  transform: scale(1.02); 
}
.btn-wood-light { 
  background-color: #e0e0e0; 
  color: #333; 
  border: 1px solid #bbb; 
  font-weight: bold; 
}

.btn-remove-active {
  background-color: #dc3545 !important; 
  color: white !important; 
  animation: pulseRed 1.5s infinite;
}
@keyframes pulseRed { 
  0%{box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);} 
  70%{box-shadow: 0 0 0 10px rgba(220, 53, 69, 0);} 
  100%{box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);} 
}

.game-header {
  background: var(--c-bg); 
  border-radius: 50px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3); 
  max-width: 800px; 
  margin: 0 auto 20px auto;
}
.timer { font-family: 'Cinzel', serif; }

.board-frame {
  padding: 15px; 
  background: #3e2723;
  border-radius: 8px; 
  box-shadow: 0 10px 20px rgba(0,0,0,0.4);
  display: inline-block;
}
.puzzle-board {
  width: 360px; 
  height: 360px; 
  background: #e3dac9;
  display: grid; 
  grid-template-columns: repeat(4, 1fr); 
  grid-template-rows: repeat(4, 1fr);
  position: relative;
}
.puzzle-slot {
  width: var(--s); 
  height: var(--s); 
  position: relative; 
  z-index: 1;
  border: none; 
}

.slot-ghost {
  position: absolute;
  top: calc(var(--r) * -1); 
  left: calc(var(--r) * -1);
  width: calc(var(--s) + var(--r) * 2); 
  height: calc(var(--s) + var(--r) * 2);
  background-color: rgba(0,0,0,0.1); 
  border: 1px dashed rgba(62, 39, 35, 0.5);
  pointer-events: none; 
  z-index: 0;
  -webkit-mask-image: var(--mask); 
  mask-image: var(--mask);
  -webkit-mask-size: 100% 100%; 
  mask-size: 100% 100%;
}

.shake-wrong {
  animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
  filter: drop-shadow(0 0 5px red) !important;
}

@keyframes shake {
  10%, 90% { transform: translate3d(-1px, 0, 0); }
  20%, 80% { transform: translate3d(2px, 0, 0); }
  30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
  40%, 60% { transform: translate3d(4px, 0, 0); }
}

.pieces-box {
  background: var(--c-bg); 
  border: 4px solid var(--c-secondary);
  border-radius: 10px; 
  min-height: 300px;
}
.pieces-grid {
  background: rgba(0,0,0,0.05); 
  overflow-y: auto; 
  padding: 20px;
  display: flex; 
  flex-wrap: wrap; 
  gap: 15px; 
  justify-content: center; 
  align-content: flex-start;
}

.puzzle-piece {
  width: calc(var(--s) + var(--r) * 2);
  height: calc(var(--s) + var(--r) * 2);
  background-color: #8d6e63; 
  cursor: grab; 
  position: relative; 
  z-index: 10;
  margin: calc(var(--r) * -0.5);
  
  filter: 
    drop-shadow(1px 0 0 #000) 
    drop-shadow(-1px 0 0 #000) 
    drop-shadow(0 1px 0 #000) 
    drop-shadow(0 -1px 0 #000)
    drop-shadow(2px 2px 2px rgba(0,0,0,0.5));
  
  transition: transform 0.1s;

  -webkit-mask-image: var(--mask); 
  mask-image: var(--mask);
  -webkit-mask-size: 100% 100%; 
  mask-size: 100% 100%;
  -webkit-mask-repeat: no-repeat; 
  mask-repeat: no-repeat;
}

.puzzle-piece:hover { 
  transform: scale(1.05); 
  z-index: 100; 
}
.puzzle-piece.selected {
  filter: 
    drop-shadow(2px 0 0 var(--c-gold)) 
    drop-shadow(-2px 0 0 var(--c-gold)) 
    drop-shadow(0 2px 0 var(--c-gold)) 
    drop-shadow(0 -2px 0 var(--c-gold));
  transform: scale(1.1); 
  z-index: 200;
}

.puzzle-piece.placed {
  position: absolute; 
  top: calc(var(--r) * -1); 
  left: calc(var(--r) * -1);
  margin: 0; 
  z-index: 5; 
  filter: 
    drop-shadow(1px 0 0 #000) 
    drop-shadow(-1px 0 0 #000) 
    drop-shadow(0 1px 0 #000) 
    drop-shadow(0 -1px 0 #000);
}

.custom-overlay {
  display: none; 
  position: fixed; 
  top: 0; left: 0; 
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.9); 
  z-index: 3000;
  justify-content: center; 
  align-items: center; 
  padding: 20px;
}
.custom-overlay.active { display: flex; }
.overlay-card {
  background: var(--c-bg); 
  border: 4px solid var(--c-primary);
  width: 100%; 
  max-width: 450px; 
  border-radius: 15px;
}
.quiz-option {
  padding: 12px; 
  background: white; 
  border: 1px solid #ccc;
  font-weight: bold; 
  cursor: pointer;
}
.quiz-option.correct { background: #27ae60; color: white; }
.quiz-option.wrong { background: #dc3545; color: white; }
.final-image-frame img {
  width: 200px; 
  height: 200px; 
  object-fit: cover;
  border-radius: 50%; 
  border: 6px solid var(--c-gold);
}

.fact-box {
  width: 360px; 
  background-color: #fff8e1; 
  border: 2px solid var(--c-primary);
  border-radius: 8px; 
  padding: 15px; 
  margin-top: 10px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2); 
  font-family: 'Lato', sans-serif;
  font-size: 0.95rem; 
  color: var(--c-dark); 
  display: flex;
  align-items: center; 
  gap: 10px; 
  min-height: 80px; 
  transition: all 0.3s ease;
}
.fact-icon { font-size: 1.5rem; }
.fact-animation { animation: highlightFact 0.5s ease; }
@keyframes highlightFact {
  0% { transform: scale(1); background-color: #fff8e1; }
  50% { transform: scale(1.02); background-color: #fffde7; }
  100% { transform: scale(1); background-color: #fff8e1; }
}

@media (max-width: 600px) {
  :root { --s: 70px; --r: 18px; }
  .puzzle-board { width: 280px; height: 280px; }
  .fact-box { width: 280px; }
  .game-title { font-size: 2rem; }
  .pieces-box { min-height: 250px; }
}